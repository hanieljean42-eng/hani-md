<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HANI-MD - Connexion Owner</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      padding: 20px;
    }
    
    .container {
      text-align: center;
      max-width: 500px;
      width: 100%;
    }
    
    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
    }
    
    .logo-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #25D366, #128C7E);
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
    }
    
    .logo-text {
      font-size: 2rem;
      font-weight: 700;
    }
    
    .card {
      background: rgba(255,255,255,0.1);
      border-radius: 25px;
      padding: 40px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    h1 {
      font-size: 1.8rem;
      margin-bottom: 10px;
    }
    
    .subtitle {
      opacity: 0.7;
      margin-bottom: 30px;
    }
    
    .qr-container {
      background: white;
      border-radius: 20px;
      padding: 20px;
      margin: 20px auto;
      width: fit-content;
      min-width: 280px;
      min-height: 280px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .qr-container img {
      max-width: 250px;
      max-height: 250px;
      border-radius: 10px;
    }
    
    .status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 15px 25px;
      border-radius: 50px;
      margin-top: 25px;
      font-weight: 600;
    }
    
    .status.waiting {
      background: rgba(255,193,7,0.2);
      color: #ffc107;
    }
    
    .status.connected {
      background: rgba(37,211,102,0.2);
      color: #25D366;
    }
    
    .status.error {
      background: rgba(220,53,69,0.2);
      color: #dc3545;
    }
    
    .pulse {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }
    
    .status.waiting .pulse { background: #ffc107; }
    .status.connected .pulse { background: #25D366; }
    .status.error .pulse { background: #dc3545; }
    
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.5; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .instructions {
      margin-top: 30px;
      text-align: left;
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
      padding: 20px;
    }
    
    .instructions h3 {
      font-size: 1rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .instructions ol {
      padding-left: 20px;
      opacity: 0.8;
      line-height: 1.8;
    }
    
    .back-link {
      display: inline-block;
      margin-top: 25px;
      color: #25D366;
      text-decoration: none;
      font-weight: 600;
    }
    
    .back-link:hover {
      text-decoration: underline;
    }
    
    .loader {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(37,211,102,0.2);
      border-top-color: #25D366;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .connected-info {
      text-align: center;
    }
    
    .connected-info .icon {
      font-size: 4rem;
      margin-bottom: 15px;
    }
    
    .connected-info .number {
      font-size: 1.2rem;
      background: rgba(37,211,102,0.2);
      padding: 10px 25px;
      border-radius: 50px;
      display: inline-block;
      margin-top: 10px;
    }
    
    .warning {
      background: rgba(255,193,7,0.15);
      border: 1px solid rgba(255,193,7,0.3);
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      font-size: 0.85rem;
      color: #ffc107;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <div class="logo-icon">ü§ñ</div>
      <div class="logo-text">HANI-MD</div>
    </div>
    
    <div class="card">
      <h1>üîê Connexion Owner</h1>
      <p class="subtitle">Scannez le QR code pour connecter votre bot</p>
      
      <div class="qr-container" id="qrContainer">
        <div class="loader"></div>
      </div>
      
      <div class="status waiting" id="status">
        <div class="pulse"></div>
        <span id="statusText">Chargement...</span>
      </div>
      
      <div class="instructions">
        <h3>üì± Instructions</h3>
        <ol>
          <li>Ouvrez WhatsApp sur votre t√©l√©phone</li>
          <li>Allez dans <strong>Param√®tres ‚Üí Appareils li√©s</strong></li>
          <li>Appuyez sur <strong>Lier un appareil</strong></li>
          <li>Scannez ce QR code</li>
        </ol>
      </div>
      
      <div class="warning">
        ‚ö†Ô∏è <strong>Attention :</strong> Cette page est r√©serv√©e au propri√©taire du bot. Ne partagez jamais ce lien.
      </div>
      
      <a href="/" class="back-link">‚Üê Retour au site</a>
    </div>
  </div>
  
  <script>
    const qrContainer = document.getElementById('qrContainer');
    const statusDiv = document.getElementById('status');
    const statusText = document.getElementById('statusText');
    
    let lastQR = null;
    
    async function checkStatus() {
      try {
        const response = await fetch('/qr');
        const data = await response.json();
        
        if (data.connected) {
          // Connect√© !
          qrContainer.innerHTML = `
            <div class="connected-info">
              <div class="icon">‚úÖ</div>
              <h2 style="color: #25D366;">Connect√© !</h2>
              <div class="number">üì± ${data.user || 'Bot actif'}</div>
            </div>
          `;
          statusDiv.className = 'status connected';
          statusText.textContent = 'Bot connect√© et op√©rationnel';
          return; // Arr√™ter le polling
        }
        
        if (data.qr && data.qr !== lastQR) {
          lastQR = data.qr;
          qrContainer.innerHTML = `<img src="${data.qr}" alt="QR Code" />`;
          statusDiv.className = 'status waiting';
          statusText.textContent = 'En attente du scan...';
        } else if (!data.qr && !data.connected) {
          qrContainer.innerHTML = '<div class="loader"></div>';
          statusDiv.className = 'status waiting';
          statusText.textContent = data.message || 'G√©n√©ration du QR code...';
        }
        
        // Continuer le polling
        setTimeout(checkStatus, 3000);
        
      } catch (error) {
        console.error('Erreur:', error);
        statusDiv.className = 'status error';
        statusText.textContent = 'Erreur de connexion au serveur';
        setTimeout(checkStatus, 5000);
      }
    }
    
    // D√©marrer le polling
    checkStatus();
  </script>
</body>
</html>
